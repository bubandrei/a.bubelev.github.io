<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="product">
    <br>
    <br>
    <br>
</div>
<p>Корзина:</p>
<div id="bucket">

</div>

</body>
<script>
    const bucketContainer = document.getElementById('bucket');
    const BUCKET_KEY = 'bucket';
    const bucketProducts = JSON.parse(localStorage.getItem(BUCKET_KEY)) || [];
    generateBucket();
    const products = [{
        title: 'Audi Q3',
        price: 20000,
    }, {
        title: 'Audi Q5',
        price: 30000,
    },
        {
            title: 'Audi Q7',
            price: 40000,
        },
        {
            title: 'Audi Q8',
            price: 50000,
        }]

    let html = ''
    products.map((item, index) => {
        html += `<div>Название${item.title}<br/>
                    Цена: ${item.price}$<br/>
                    <button onclick="addCar(${index})">Добавить в корзину</button> </div>`
    })

    function generateBucket() {
        let bucketHtml = ''
        let total = 0;
        bucketProducts.forEach((item, index) => {
            total += item.price * item.count;
            bucketHtml += `<div>Название${item.title}
                    Цена: ${item.price}
                    <button onclick="add(${index}, -1)">-</button>
                    Количество: ${item.count}
                    <button onclick="add(${index}, 1)">+</button>
                    Всего: ${item.price * item.count}
                    <button onclick="deleteFromBucket(${index})">Удалить из корзины</button> </div>`
        })
        if (bucketHtml === '') {
            bucketHtml = 'Здесь будут ваши продукты'
        } else {
            bucketHtml += `<div>Всего: ${total}</div>`
        }
        bucketContainer.innerHTML = bucketHtml;
    }


    function add(carIndex, num) {
        const car = bucketProducts[carIndex];
        car.count = car.count + num;
        if (car.count === 0) {
            bucketProducts.splice(carIndex, 1)
        }
        localStorage.setItem(BUCKET_KEY, JSON.stringify(bucketProducts))
        generateBucket();
    }

    function deleteFromBucket(bucketItemIndex) {
        bucketProducts.splice(bucketItemIndex, 1);
        localStorage.setItem(BUCKET_KEY, JSON.stringify(bucketProducts))
        generateBucket();
    }

    function addCar(carIndex) {
        const car = products[carIndex];
        const foundCar = bucketProducts.find(item => item.title === car.title);
        if (foundCar) {
            foundCar.count++;
        } else {
            car.count = 1
            bucketProducts.push(car);
        }
        generateBucket();
        localStorage.setItem(BUCKET_KEY, JSON.stringify(bucketProducts))
    }

    document.body.firstElementChild.innerHTML = html;
</script>
</html>